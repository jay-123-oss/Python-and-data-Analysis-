<!-- templates/index.html -->
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mini SMS Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="p-4">
    <div class="container">
      <h3>Mini SMS App</h3>
      <div class="mb-3">
        <input id="to" class="form-control" placeholder="Recipient phone (+91...)" />
      </div>
      <div class="mb-3">
        <textarea id="body" class="form-control" rows="3" placeholder="Message"></textarea>
      </div>
      <button id="sendBtn" class="btn btn-primary">Send SMS</button>

      <hr/>
      <h5>Recent messages</h5>
      <ul id="messagesList" class="list-group mt-2"></ul>
    </div>

    <script>
      async function fetchMessages(){
        const r = await fetch('/messages');
        const data = await r.json();
        const list = document.getElementById('messagesList');
        list.innerHTML = '';
        data.forEach(m => {
          const li = document.createElement('li');
          li.className = 'list-group-item';
          li.textContent = `${m.timestamp} | ${m.direction.toUpperCase()} | ${m.from} â†’ ${m.to} | ${m.body}`;
          list.appendChild(li);
        });
      }
      document.getElementById('sendBtn').addEventListener('click', async () => {
        const to = document.getElementById('to').value;
        const body = document.getElementById('body').value;
        await fetch('/send', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({to, body})
        });
        document.getElementById('body').value = '';
        fetchMessages();
      });
      fetchMessages();
      setInterval(fetchMessages, 5000); // poll every 5s (simple approach)
    </script>
  </body>
</html>
